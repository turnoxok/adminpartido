<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Evento Rugby - Menú</title>
<style>
  body { font-family: 'Courier New', monospace; background: #f0e6d2; color:#222; padding:20px;}
  h1,h2,h3 { text-align:center; }
  input, button { font-family: 'Courier New', monospace; padding:5px; margin:5px; border-radius:4px; border:1px solid #555;}
  button { background:#cda34d; color:#fff; cursor:pointer; }
  button:hover { background:#b5892f; }
  .menu { background:#fff0d4; padding:10px; margin:10px 0; border:1px solid #cda34d; border-radius:6px;}
  ul { list-style:none; padding-left:0; }
  li { padding:4px 0; }
  input[type=radio] { margin-right:5px; }
  #app { display:none; }
</style>
</head>
<body>
<h1>Evento Rugby - Menú</h1>

<div id="login">
  <h2>Login</h2>
  <input id="user" placeholder="Usuario">
  <input id="pass" type="password" placeholder="Clave">
  <button onclick="login()">Entrar</button>
</div>

<div id="app">
  <h2>Bienvenido <span id="rolText"></span></h2>
  <div id="menuContainer"></div>
  <h3>Total General: $<span id="totalGeneral">0</span></h3>
</div>

<script>
const URL_APPSCRIPT = "https://script.google.com/macros/s/AKfycbw0jCHGqSNThttU2-D4bBiu4t-QL_C2h9_OnclWaYqPP-y0SYZovks9EIZdkM_HvSwV_A/exec"; // reemplaza con tu WebApp
let rol=null, usuarioActual=null, claveActual=null;

async function login(){
  usuarioActual = document.getElementById("user").value;
  claveActual = document.getElementById("pass").value;

  const res = await fetch(URL_APPSCRIPT,{
    method:"POST",
    body: JSON.stringify({action:"login", usuario:usuarioActual, clave:claveActual})
  });
  const data = await res.json();
  if(data.status==="ok"){
    rol = data.rol;
    document.getElementById("rolText").innerText = rol;
    document.getElementById("login").style.display="none";
    document.getElementById("app").style.display="block";
    cargarMenu();
  } else alert(data.msg);
}

async function cargarMenu(){
  const res = await fetch(URL_APPSCRIPT+"?hoja=Menu");
  const data = await res.json();

  const menus = {};
  data.forEach(r=>{
    if(!menus[r.NombreMenu]) menus[r.NombreMenu]=[];
    menus[r.NombreMenu].push(r);
  });

  let html="";
  let totalGeneral = 0;
  Object.keys(menus).forEach(menu=>{
    html+=`<div class="menu"><h3>${menu}</h3><ul>`;
    menus[menu].forEach((item,i)=>{
      const disabled = (rol!=="dirigente" && item.Seleccionado) || item.Seleccionado?"disabled":"";
      const checked = item.Seleccionado?"checked":"";
      if(item.Seleccionado) totalGeneral+=Number(item.Precio);
      html+=`<li>
        <input type="radio" name="${menu}" ${disabled} ${checked} onchange="seleccionar('${menu}','${item.Proveedor}')">
        ${item.Proveedor} - ${item.Descripcion} - $${item.Precio} - Total: $${item.Total}
      </li>`;
    });
    html+="</ul></div>";
  });

  document.getElementById("menuContainer").innerHTML = html;
  document.getElementById("totalGeneral").innerText = totalGeneral;
}

function seleccionar(menu, proveedor){
  if(rol!=="dirigente") return;
  fetch(URL_APPSCRIPT,{
    method:"POST",
    body: JSON.stringify({
      usuario: usuarioActual,
      clave: claveActual,
      NombreMenu: menu,
      Proveedor: proveedor,
      Voto:1
    })
  }).then(res=>res.json()).then(res=>{
    if(res.status==="ok") cargarMenu();
    else alert(res.msg);
  });
}
</script>
</body>
</html>
